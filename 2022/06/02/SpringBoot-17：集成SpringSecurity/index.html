<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SpringBoot-17：集成SpringSecurity | ChenNuo-Blog</title><meta name="keywords" content="SpringBoot的学习笔记"><meta name="author" content="ChenNuo"><meta name="copyright" content="ChenNuo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringBoot-17：集成SpringSecuritySpringSecurity安全简介 在 Web 开发中，安全一直是非常重要的一个方面。安全虽然属于应用的非功能性需求，但是应该在应用开 发的初期就考虑进来。如果在应用开发的后期才考虑安全的问题，就可能陷入一个两难的境地：一方面，应 用存在严重的安全漏洞，无法满足用户的要求，并可能造成用户的隐私数据被攻击者窃取；另一方面，应用 的基本架构">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot-17：集成SpringSecurity">
<meta property="og:url" content="http://chennuo252.top/2022/06/02/SpringBoot-17%EF%BC%9A%E9%9B%86%E6%88%90SpringSecurity/index.html">
<meta property="og:site_name" content="ChenNuo-Blog">
<meta property="og:description" content="SpringBoot-17：集成SpringSecuritySpringSecurity安全简介 在 Web 开发中，安全一直是非常重要的一个方面。安全虽然属于应用的非功能性需求，但是应该在应用开 发的初期就考虑进来。如果在应用开发的后期才考虑安全的问题，就可能陷入一个两难的境地：一方面，应 用存在严重的安全漏洞，无法满足用户的要求，并可能造成用户的隐私数据被攻击者窃取；另一方面，应用 的基本架构">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2022/05/08/OlvikQ.jpg">
<meta property="article:published_time" content="2022-06-02T13:36:27.000Z">
<meta property="article:modified_time" content="2022-07-08T06:30:14.309Z">
<meta property="article:author" content="ChenNuo">
<meta property="article:tag" content="SpringBoot的学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/05/08/OlvikQ.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://chennuo252.top/2022/06/02/SpringBoot-17%EF%BC%9A%E9%9B%86%E6%88%90SpringSecurity/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot-17：集成SpringSecurity',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-08 14:30:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-artitalk-pro/lib/card.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-clock/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/share/"><i class="fa-fw fa fa-heartbeat"></i><span> 生活</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2022/05/08/OlvikQ.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ChenNuo-Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/share/"><i class="fa-fw fa fa-heartbeat"></i><span> 生活</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot-17：集成SpringSecurity</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-06-02T13:36:27.000Z" title="发表于 2022-06-02 21:36:27">2022-06-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-08T06:30:14.309Z" title="更新于 2022-07-08 14:30:14">2022-07-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot-17：集成SpringSecurity"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SpringBoot-17：集成SpringSecurity"><a href="#SpringBoot-17：集成SpringSecurity" class="headerlink" title="SpringBoot-17：集成SpringSecurity"></a>SpringBoot-17：集成SpringSecurity</h1><h3 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h3><h4 id="安全简介"><a href="#安全简介" class="headerlink" title="安全简介"></a>安全简介</h4><p> 在 Web 开发中，安全一直是非常重要的一个方面。安全虽然属于应用的非功能性需求，但是应该在应用开 发的初期就考虑进来。如果在应用开发的后期才考虑安全的问题，就可能陷入一个两难的境地：一方面，应 用存在严重的安全漏洞，无法满足用户的要求，并可能造成用户的隐私数据被攻击者窃取；另一方面，应用 的基本架构已经确定，要修复安全漏洞，可能需要对系统的架构做出比较重大的调整，因而需要更多的开发 时间，影响应用的发布进程。因此，从应用开发的第一天就应该把安全相关的因素考虑进来，并在整个应用 的开发过程中。</p>
<p> 市面上存在比较有名的：Shiro，Spring Security ！</p>
<p> 这里需要阐述一下的是，每一个框架的出现都是为了解决某一问题而产生了，那么Spring Security框架的出 现是为了解决什么问题呢？</p>
<p> 首先我们看下它的官网介绍：Spring Security官网地址</p>
<p> Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based applications.</p>
<p> Spring Security is a framework that focuses on providing both authentication and authorization to Java applications. Like all Spring projects, the real power of Spring Security is found in how easily it can be extended to meet custom requirements</p>
<p> Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。它实际上是保护基于spring的应 用程序的标准。</p>
<p> Spring Security是一个框架，侧重于为Java应用程序提供身份验证和授权。与所有Spring项目一样，Spring 安全性的真正强大之处在于它可以轻松地扩展以满足定制需求 </p>
<p>从官网的介绍中可以知道这是一个权限框架。想我们之前做项目是没有使用框架是怎么控制权限的？对于权 限 一般会细分为功能权限，访问权限，和菜单权限。代码会写的非常的繁琐，冗余。 </p>
<p>怎么解决之前写权限代码繁琐，冗余的问题，一些主流框架就应运而生而Spring Scecurity就是其中的一种。</p>
<p> Spring 是一个非常流行和成功的 Java 应用开发框架。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。一般来说，Web 应用的安全性包括用户认证（Authentication）和用户授权 （Authorization）两个部分。用户认证指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访 问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。用户授 权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对 一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不 同的角色，而每个角色则对应一系列的权限。</p>
<p> 对于上面提到的两种应用情景，Spring Security 框架都有很好的支持。在用户认证方面，Spring Security 框 架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、OpenID 和 LDAP 等。 在用户授权方面，Spring Security 提供了基于角色的访问控制和访问控制列表（Access Control List， ACL），可以对应用中的领域对象进行细粒度的控制。 </p>
<h4 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h4><p> 实验环境搭建 </p>
<p>1、新建一个初始的springboot项目web模块，thymeleaf模块</p>
<p>2、导入静态资源 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">welcome.html</span><br><span class="line">|views</span><br><span class="line">|level1</span><br><span class="line">1.html</span><br><span class="line">2.html</span><br><span class="line">3.html</span><br><span class="line">|level2</span><br><span class="line">1.html</span><br><span class="line">2.html</span><br><span class="line">3.html</span><br><span class="line">|level3</span><br><span class="line">1.html</span><br><span class="line">2.html</span><br><span class="line">3.html</span><br><span class="line">Login.html</span><br></pre></td></tr></table></figure>

<p> 3、controller跳转！ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">@Controller</span><br><span class="line">public class RouterController &#123;</span><br><span class="line">@RequestMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)</span><br><span class="line">public String index()&#123;</span><br><span class="line">return &quot;index&quot;;</span><br><span class="line">&#125;</span><br><span class="line">@RequestMapping(&quot;/toLogin&quot;)</span><br><span class="line">public String toLogin()&#123;</span><br><span class="line">return &quot;views/login&quot;;</span><br><span class="line">&#125;</span><br><span class="line">@RequestMapping(&quot;/level1/&#123;id&#125;&quot;)</span><br><span class="line">public String level1(@PathVariable(&quot;id&quot;) int id)&#123;</span><br><span class="line">return &quot;views/level1/&quot;+id;</span><br><span class="line">&#125;</span><br><span class="line">@RequestMapping(&quot;/level2/&#123;id&#125;&quot;)</span><br><span class="line">public String level2(@PathVariable(&quot;id&quot;) int id)&#123;</span><br><span class="line">return &quot;views/level2/&quot;+id;</span><br><span class="line">&#125;</span><br><span class="line">@RequestMapping(&quot;/level3/&#123;id&#125;&quot;)</span><br><span class="line">public String level3(@PathVariable(&quot;id&quot;) int id)&#123;</span><br><span class="line">return &quot;views/level3/&quot;+id;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 4、测试实验环境是否OK！ </p>
<h4 id="认识SpringSecurity"><a href="#认识SpringSecurity" class="headerlink" title="认识SpringSecurity"></a>认识SpringSecurity</h4><p> Spring Security 是针对Spring项目的安全框架，也是Spring Boot底层安全模块默认的技术选型，他可以实 现强大的Web安全控制，对于安全控制，我们仅需要引入 spring-boot-starter-security 模块，进行少量的 配置，即可实现强大的安全管理！</p>
<p> 记住几个类： </p>
<ul>
<li> WebSecurityConfigurerAdapter：自定义Security策略</li>
<li> AuthenticationManagerBuilder：自定义认证策略</li>
<li> @EnableWebSecurity：开启WebSecurity模式  </li>
</ul>
<p> Spring Security的两个主要目标是 “认证” 和 “授权”（访问控制）。</p>
<p> “认证”（Authentication） </p>
<p> 身份验证是关于验证您的凭据，如用户名/用户ID和密码，以验证您的身份。</p>
<p> 身份验证通常通过用户名和密码完成，有时与身份验证因素结合使用。</p>
<p> “授权” （Authorization）</p>
<p> 授权发生在系统成功验证您的身份后，最终会授予您访问资源（如信息，文件，数据库，资金，位置，几乎 任何内容）的完全权限。 </p>
<p>这个概念是通用的，而不是只在Spring Security 中存在。 </p>
<h4 id="认证和授权"><a href="#认证和授权" class="headerlink" title="认证和授权"></a>认证和授权</h4><p> 目前，我们的测试环境，是谁都可以访问的，我们使用 Spring Security 增加上认证和授权的功能 1、引入 Spring Security 模块 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p> 2、编写 Spring Security 配置类</p>
<p> 参考官网：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a> </p>
<p>查看我们自己项目中的版本，找到对应的帮助文档：</p>
<p> <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.0.RELEASE/reference/html5">https://docs.spring.io/spring-security/site/docs/5.3.0.RELEASE/reference/html5</a> #servlet-applications 8.16.4 </p>
<p><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/07/08/jBV7y6.png" alt="1657081275148"></p>
<p> 3、编写基础配置类 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.kuang.config;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line">import</span><br><span class="line">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><br><span class="line">;</span><br><span class="line">@EnableWebSecurity // 开启WebSecurity模式</span><br><span class="line">public class SecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">@Override</span><br><span class="line">protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 4、定制请求的授权规则 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">// 定制请求的授权规则</span><br><span class="line">// 首页所有人可以访问</span><br><span class="line">http.authorizeRequests().antMatchers(&quot;/&quot;).permitAll()</span><br><span class="line">.antMatchers(&quot;/level1/**&quot;).hasRole(&quot;vip1&quot;)</span><br><span class="line">.antMatchers(&quot;/level2/**&quot;).hasRole(&quot;vip2&quot;)</span><br><span class="line">.antMatchers(&quot;/level3/**&quot;).hasRole(&quot;vip3&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 5、测试一下：发现除了首页都进不去了！因为我们目前没有登录的角色，因为请求需要登录的角色拥有对 应的权限才可以！</p>
<p> 6、在configure()方法中加入以下配置，开启自动配置的登录功能！ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 开启自动配置的登录功能</span><br><span class="line">// /login 请求来到登录页</span><br><span class="line">// /login?error 重定向到这里表示登录失败</span><br><span class="line">http.formLogin();</span><br></pre></td></tr></table></figure>

<p> 7、测试一下：发现，没有权限的时候，会跳转到登录的页面！  </p>
<p><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/07/08/jBVHOK.png" alt="1657081325680"></p>
<p> 8、查看刚才登录页的注释信息；</p>
<p> 我们可以定义认证规则，重写configure(AuthenticationManagerBuilder auth)方法  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//定义认证规则</span><br><span class="line">@Override</span><br><span class="line">protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">//在内存中定义，也可以在jdbc中去拿....</span><br><span class="line">auth.inMemoryAuthentication()</span><br><span class="line">.withUser(&quot;kuangshen&quot;).password(&quot;123456&quot;).roles(&quot;vip2&quot;,&quot;vip3&quot;)</span><br><span class="line">.and()</span><br><span class="line">.withUser(&quot;root&quot;).password(&quot;123456&quot;).roles(&quot;vip1&quot;,&quot;vip2&quot;,&quot;vip3&quot;)</span><br><span class="line">.and()</span><br><span class="line">.withUser(&quot;guest&quot;).password(&quot;123456&quot;).roles(&quot;vip1&quot;,&quot;vip2&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 9、测试，我们可以使用这些账号登录进行测试！发现会报错！</p>
<p> There is no PasswordEncoder mapped for the id “null” </p>
<p><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/07/08/jBVqeO.png" alt="1657081393261"></p>
<p> 10、原因，我们要将前端传过来的密码进行某种方式加密，否则就无法登录，修改代码 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//定义认证规则</span><br><span class="line">@Override</span><br><span class="line">protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">//在内存中定义，也可以在jdbc中去拿....</span><br><span class="line">//Spring security 5.0中新增了多种加密方式，也改变了密码的格式。</span><br><span class="line">//要想我们的项目还能够正常登陆，需要修改一下configure中的代码。我们要将前端传过来的密码进行某种方式加</span><br><span class="line">密</span><br><span class="line">//spring security 官方推荐的是使用bcrypt加密方式。</span><br><span class="line">auth.inMemoryAuthentication().passwordEncoder(new BCryptPasswordEncoder())</span><br><span class="line">.withUser(&quot;kuangshen&quot;).password(new</span><br><span class="line">BCryptPasswordEncoder().encode(&quot;123456&quot;)).roles(&quot;vip2&quot;,&quot;vip3&quot;)</span><br><span class="line">.and()</span><br><span class="line">.withUser(&quot;root&quot;).password(new</span><br><span class="line">BCryptPasswordEncoder().encode(&quot;123456&quot;)).roles(&quot;vip1&quot;,&quot;vip2&quot;,&quot;vip3&quot;)</span><br><span class="line">.and()</span><br><span class="line">.withUser(&quot;guest&quot;).password(new</span><br><span class="line">BCryptPasswordEncoder().encode(&quot;123456&quot;)).roles(&quot;vip1&quot;,&quot;vip2&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 11、测试，发现，登录成功，并且每个角色只能访问自己认证下的规则！搞定 </p>
<h4 id="权限控制和注销"><a href="#权限控制和注销" class="headerlink" title="权限控制和注销"></a>权限控制和注销</h4><p> 1、开启自动配置的注销的功能  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//定制请求的授权规则</span><br><span class="line">@Override</span><br><span class="line">protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">//....</span><br><span class="line">//开启自动配置的注销的功能</span><br><span class="line">// /logout 注销请求</span><br><span class="line">http.logout();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 2、我们在前端，增加一个注销的按钮，index.html 导航栏中 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a class=&quot;item&quot; th:href=&quot;@&#123;/logout&#125;&quot;&gt;</span><br><span class="line">&lt;i class=&quot;address card icon&quot;&gt;&lt;/i&gt; 注销</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p> 3、我们可以去测试一下，登录成功后点击注销，发现注销完毕会跳转到登录页面！</p>
<p> 4、但是，我们想让他注销成功后，依旧可以跳转到首页，该怎么处理呢？ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// .logoutSuccessUrl(&quot;/&quot;); 注销成功来到首页</span><br><span class="line">http.logout().logoutSuccessUrl(&quot;/&quot;);</span><br></pre></td></tr></table></figure>

<p> 5、测试，注销完毕后，发现跳转到首页OK</p>
<p> 6、我们现在又来一个需求：用户没有登录的时候，导航栏上只显示登录按钮，用户登录之后，导航栏可以 显示登录的用户信息及注销按钮！还有就是，比如kuangshen这个用户，它只有 vip2，vip3功能，那么登 录则只显示这两个功能，而vip1的功能菜单不显示！这个就是真实的网站情况了！该如何做呢？</p>
<p> 我们需要结合thymeleaf中的一些功能</p>
<p> sec：authorize=”isAuthenticated()”:是否认证登录！来显示不同的页面</p>
<p> Maven依赖： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.thymeleaf.extras/thymeleaf-extras-springsecurity4</span><br><span class="line">--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;3.0.4.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p> 7、修改我们的 前端页面 </p>
<p> 导入命名空间 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xmlns:sec=&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity5&quot;</span><br></pre></td></tr></table></figure>

<p> 修改导航栏，增加认证判断 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--登录注销--&gt;</span><br><span class="line">&lt;div class=&quot;right menu&quot;&gt;</span><br><span class="line">&lt;!--如果未登录--&gt;</span><br><span class="line">&lt;div sec:authorize=&quot;!isAuthenticated()&quot;&gt;</span><br><span class="line">&lt;a class=&quot;item&quot; th:href=&quot;@&#123;/login&#125;&quot;&gt;</span><br><span class="line">&lt;i class=&quot;address card icon&quot;&gt;&lt;/i&gt; 登录</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--如果已登录--&gt;</span><br><span class="line">&lt;div sec:authorize=&quot;isAuthenticated()&quot;&gt;</span><br><span class="line">&lt;a class=&quot;item&quot;&gt;</span><br><span class="line">&lt;i class=&quot;address card icon&quot;&gt;&lt;/i&gt;</span><br><span class="line">用户名：&lt;span sec:authentication=&quot;principal.username&quot;&gt;&lt;/span&gt;</span><br><span class="line">角色：&lt;span sec:authentication=&quot;principal.authorities&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div sec:authorize=&quot;isAuthenticated()&quot;&gt;</span><br><span class="line">&lt;a class=&quot;item&quot; th:href=&quot;@&#123;/logout&#125;&quot;&gt;</span><br><span class="line">&lt;i class=&quot;address card icon&quot;&gt;&lt;/i&gt; 注销</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p> 8、重启测试，我们可以登录试试看，登录成功后确实，显示了我们想要的页面；</p>
<p> 9、如果注销404了，就是因为它默认防止csrf跨站请求伪造，因为会产生安全问题，我们可以将请求改为 post表单提交，或者在spring security中关闭csrf功能；我们试试：在 配置中增加 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http.csrf().disable();//关闭csrf功能:跨站请求伪造,默认只能通过post方式提交logout请求</span><br><span class="line">http.logout().logoutSuccessUrl(&quot;/&quot;);</span><br></pre></td></tr></table></figure>

<p> 10、我们继续将下面的角色功能块认证完成！  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- sec:authorize=&quot;hasRole(&#x27;vip1&#x27;)&quot; --&gt;</span><br><span class="line">&lt;div class=&quot;column&quot; sec:authorize=&quot;hasRole(&#x27;vip1&#x27;)&quot;&gt;</span><br><span class="line">&lt;div class=&quot;ui raised segment&quot;&gt;</span><br><span class="line">&lt;div class=&quot;ui&quot;&gt;</span><br><span class="line">&lt;div class=&quot;content&quot;&gt;</span><br><span class="line">&lt;h5 class=&quot;content&quot;&gt;Level 1&lt;/h5&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level1/1&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-1-1&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level1/2&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-1-2&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level1/3&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-1-3&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;column&quot; sec:authorize=&quot;hasRole(&#x27;vip2&#x27;)&quot;&gt;</span><br><span class="line">&lt;div class=&quot;ui raised segment&quot;&gt;</span><br><span class="line">&lt;div class=&quot;ui&quot;&gt;</span><br><span class="line">&lt;div class=&quot;content&quot;&gt;</span><br><span class="line">&lt;h5 class=&quot;content&quot;&gt;Level 2&lt;/h5&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level2/1&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-2-1&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level2/2&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-2-2&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level2/3&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-2-3&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;column&quot; sec:authorize=&quot;hasRole(&#x27;vip3&#x27;)&quot;&gt;</span><br><span class="line">&lt;div class=&quot;ui raised segment&quot;&gt;</span><br><span class="line">&lt;div class=&quot;ui&quot;&gt;</span><br><span class="line">&lt;div class=&quot;content&quot;&gt;</span><br><span class="line">&lt;h5 class=&quot;content&quot;&gt;Level 3&lt;/h5&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level3/1&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-3-1&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level3/2&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-3-2&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&lt;a th:href=&quot;@&#123;/level3/3&#125;&quot;&gt;&lt;i class=&quot;bullhorn icon&quot;&gt;&lt;/i&gt; Level-3-3&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p> 11、测试一下！</p>
<p> 12、权限控制和注销搞定！ </p>
<h4 id="记住我"><a href="#记住我" class="headerlink" title="记住我"></a>记住我</h4><p> 现在的情况，我们只要登录之后，关闭浏览器，再登录，就会让我们重新登录，但是很多网站的情况，就是 有一个记住密码的功能，这个该如何实现呢？很简单</p>
<p> 1、开启记住我功能 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//定制请求的授权规则</span><br><span class="line">@Override</span><br><span class="line">protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">//。。。。。。。。。。。</span><br><span class="line">//记住我</span><br><span class="line">http.rememberMe();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 2、我们再次启动项目测试一下，发现登录页多了一个记住我功能，我们登录之后关闭 浏览器，然后重新打 开浏览器访问，发现用户依旧存在！ 思考：如何实现的呢？其实非常简单</p>
<p> 我们可以查看浏览器的cookie </p>
<p><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/07/08/jBVOTe.png" alt="1657081893893"></p>
<p> 4、结论：登录成功后，将cookie发送给浏览器保存，以后登录带上这个cookie，只要通过检查就可以免登 录了。如果点击注销，则会删除这个cookie，具体的原理我们在JavaWeb阶段都讲过了，这里就不在多说 了！ </p>
<h4 id="定制登录页"><a href="#定制登录页" class="headerlink" title="定制登录页"></a>定制登录页</h4><p> 现在这个登录页面都是spring security 默认的，怎么样可以使用我们自己写的Login界面呢？</p>
<p> 1、在刚才的登录页配置后面指定 loginpage </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http.formLogin().loginPage(&quot;/toLogin&quot;);</span><br></pre></td></tr></table></figure>

<p> 2、然后前端也需要指向我们自己定义的 login请求 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a class=&quot;item&quot; th:href=&quot;@&#123;/toLogin&#125;&quot;&gt;</span><br><span class="line">&lt;i class=&quot;address card icon&quot;&gt;&lt;/i&gt; 登录</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p> 3、我们登录，需要将这些信息发送到哪里，我们也需要配置，login.html 配置提交请求及方式，方式必须 为post: </p>
<p>在 loginPage()源码中的注释上有写明： </p>
<p><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/07/08/jBVLwD.png" alt="1657081940890"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;form th:action=&quot;@&#123;/login&#125;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;div class=&quot;field&quot;&gt;</span><br><span class="line">&lt;label&gt;Username&lt;/label&gt;</span><br><span class="line">&lt;div class=&quot;ui left icon input&quot;&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; placeholder=&quot;Username&quot; name=&quot;username&quot;&gt;</span><br><span class="line">&lt;i class=&quot;user icon&quot;&gt;&lt;/i&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;field&quot;&gt;</span><br><span class="line">&lt;label&gt;Password&lt;/label&gt;</span><br><span class="line">&lt;div class=&quot;ui left icon input&quot;&gt;</span><br><span class="line">&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;</span><br><span class="line">&lt;i class=&quot;lock icon&quot;&gt;&lt;/i&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; class=&quot;ui blue submit button&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p> 4、这个请求提交上来，我们还需要验证处理，怎么做呢？我们可以查看formLogin()方法的源码！我们配置 接收登录的用户名和密码的参数！  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http.formLogin()</span><br><span class="line">.usernameParameter(&quot;username&quot;)</span><br><span class="line">.passwordParameter(&quot;password&quot;)</span><br><span class="line">.loginPage(&quot;/toLogin&quot;)</span><br><span class="line">.loginProcessingUrl(&quot;/login&quot;); // 登陆表单提交请求</span><br></pre></td></tr></table></figure>

<p> 5、在登录页增加记住我的多选框 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;input type=&quot;checkbox&quot; name=&quot;remember&quot;&gt; 记住我</span><br></pre></td></tr></table></figure>

<p> 6、后端验证处理！ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//定制记住我的参数！</span><br><span class="line">http.rememberMe().rememberMeParameter(&quot;remember&quot;);</span><br></pre></td></tr></table></figure>

<p> 7、测试，OK  </p>
<h4 id="完整配置代码"><a href="#完整配置代码" class="headerlink" title="完整配置代码"></a>完整配置代码</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.kuang.config;</span><br><span class="line">import</span><br><span class="line">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerB</span><br><span class="line">uilder;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line">import</span><br><span class="line">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><br><span class="line">;</span><br><span class="line">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">public class SecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">//定制请求的授权规则</span><br><span class="line">@Override</span><br><span class="line">protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">http.authorizeRequests().antMatchers(&quot;/&quot;).permitAll()</span><br><span class="line">.antMatchers(&quot;/level1/**&quot;).hasRole(&quot;vip1&quot;)</span><br><span class="line">.antMatchers(&quot;/level2/**&quot;).hasRole(&quot;vip2&quot;)</span><br><span class="line">.antMatchers(&quot;/level3/**&quot;).hasRole(&quot;vip3&quot;);</span><br><span class="line">//开启自动配置的登录功能：如果没有权限，就会跳转到登录页面！</span><br><span class="line">// /login 请求来到登录页</span><br><span class="line">// /login?error 重定向到这里表示登录失败</span><br><span class="line">http.formLogin()</span><br><span class="line">.usernameParameter(&quot;username&quot;)</span><br><span class="line">.passwordParameter(&quot;password&quot;)</span><br><span class="line">.loginPage(&quot;/toLogin&quot;)</span><br><span class="line">.loginProcessingUrl(&quot;/login&quot;); // 登陆表单提交请求</span><br><span class="line">//开启自动配置的注销的功能</span><br><span class="line">// /logout 注销请求</span><br><span class="line">// .logoutSuccessUrl(&quot;/&quot;); 注销成功来到首页</span><br><span class="line">http.csrf().disable();//关闭csrf功能:跨站请求伪造,默认只能通过post方式提交logout请求</span><br><span class="line">http.logout().logoutSuccessUrl(&quot;/&quot;);</span><br><span class="line">//记住我</span><br><span class="line">http.rememberMe().rememberMeParameter(&quot;remember&quot;);</span><br><span class="line">&#125;</span><br><span class="line">//定义认证规则</span><br><span class="line">@Override</span><br><span class="line">protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">//在内存中定义，也可以在jdbc中去拿....</span><br><span class="line">//Spring security 5.0中新增了多种加密方式，也改变了密码的格式。</span><br><span class="line">//要想我们的项目还能够正常登陆，需要修改一下configure中的代码。我们要将前端传过来的密码进行某种</span><br><span class="line">方式加密</span><br><span class="line">//spring security 官方推荐的是使用bcrypt加密方式。</span><br><span class="line">auth.inMemoryAuthentication().passwordEncoder(new BCryptPasswordEncoder())</span><br><span class="line">.withUser(&quot;kuangshen&quot;).password(new</span><br><span class="line">BCryptPasswordEncoder().encode(&quot;123456&quot;)).roles(&quot;vip2&quot;,&quot;vip3&quot;)</span><br><span class="line">.and()</span><br><span class="line">.withUser(&quot;root&quot;).password(new</span><br><span class="line">BCryptPasswordEncoder().encode(&quot;123456&quot;)).roles(&quot;vip1&quot;,&quot;vip2&quot;,&quot;vip3&quot;)</span><br><span class="line">.and()</span><br><span class="line">.withUser(&quot;guest&quot;).password(new</span><br><span class="line">BCryptPasswordEncoder().encode(&quot;123456&quot;)).roles(&quot;vip1&quot;,&quot;vip2&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ChenNuo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://chennuo252.top/2022/06/02/SpringBoot-17%EF%BC%9A%E9%9B%86%E6%88%90SpringSecurity/">http://chennuo252.top/2022/06/02/SpringBoot-17%EF%BC%9A%E9%9B%86%E6%88%90SpringSecurity/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://chennuo252.top" target="_blank">ChenNuo-Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot%E7%9A%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">SpringBoot的学习笔记</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2022/05/08/OlvikQ.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/06/01/SpringBoot-16%EF%BC%9ADubbo%E5%92%8CZookeeper%E9%9B%86%E6%88%90/"><img class="next-cover" src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvnmT.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringBoot-16：Dubbo和Zookeeper集成</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/30/SpringBoot-11%EF%BC%9AThymeleaf%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/" title="SpringBoot-11：Thymeleaf模板引擎"><img class="cover" src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/Olvkfs.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-30</div><div class="title">SpringBoot-11：Thymeleaf模板引擎</div></div></a></div><div><a href="/2022/05/21/SpringBoot-02%EF%BC%9A%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%9D%E6%8E%A2/" title="SpringBoot-02：运行原理初探"><img class="cover" src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvCTg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-21</div><div class="title">SpringBoot-02：运行原理初探</div></div></a></div><div><a href="/2022/05/20/SpringBoot-01%EF%BC%9AHello,World%EF%BC%81/" title="SpringBoot-01：Hello,World！"><img class="cover" src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvEpn.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-20</div><div class="title">SpringBoot-01：Hello,World！</div></div></a></div><div><a href="/2022/05/24/SpringBoot-05%EF%BC%9A%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/" title="SpringBoot-05：自动配置原理"><img class="cover" src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/Olv90S.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-24</div><div class="title">SpringBoot-05：自动配置原理</div></div></a></div><div><a href="/2022/05/23/SpringBoot-04%EF%BC%9AJSR303%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C%E5%8F%8A%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%88%87%E6%8D%A2/" title="SpringBoot-04：JSR303数据校验及多环境切换"><img class="cover" src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/Olv90S.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-23</div><div class="title">SpringBoot-04：JSR303数据校验及多环境切换</div></div></a></div><div><a href="/2022/05/25/SpringBoot-06%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89starter/" title="SpringBoot-06：自定义starter"><img class="cover" src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvnmT.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-25</div><div class="title">SpringBoot-06：自定义starter</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ChenNuo</div><div class="author-info__description">博客因兴趣诞生,在不断完善中</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ChenNuo252"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ChenNuo252" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2824846062@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=2824846062&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot-17%EF%BC%9A%E9%9B%86%E6%88%90SpringSecurity"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot-17：集成SpringSecurity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringSecurity"><span class="toc-number">1.0.1.</span> <span class="toc-text">SpringSecurity</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">1.0.1.1.</span> <span class="toc-text">安全简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">1.0.1.2.</span> <span class="toc-text">实战测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86SpringSecurity"><span class="toc-number">1.0.1.3.</span> <span class="toc-text">认识SpringSecurity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83"><span class="toc-number">1.0.1.4.</span> <span class="toc-text">认证和授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%92%8C%E6%B3%A8%E9%94%80"><span class="toc-number">1.0.1.5.</span> <span class="toc-text">权限控制和注销</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%B0%E4%BD%8F%E6%88%91"><span class="toc-number">1.0.1.6.</span> <span class="toc-text">记住我</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E7%99%BB%E5%BD%95%E9%A1%B5"><span class="toc-number">1.0.1.7.</span> <span class="toc-text">定制登录页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81"><span class="toc-number">1.0.1.8.</span> <span class="toc-text">完整配置代码</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/06/02/SpringBoot-17%EF%BC%9A%E9%9B%86%E6%88%90SpringSecurity/" title="SpringBoot-17：集成SpringSecurity"><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvikQ.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot-17：集成SpringSecurity"/></a><div class="content"><a class="title" href="/2022/06/02/SpringBoot-17%EF%BC%9A%E9%9B%86%E6%88%90SpringSecurity/" title="SpringBoot-17：集成SpringSecurity">SpringBoot-17：集成SpringSecurity</a><time datetime="2022-06-02T13:36:27.000Z" title="发表于 2022-06-02 21:36:27">2022-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/01/SpringBoot-16%EF%BC%9ADubbo%E5%92%8CZookeeper%E9%9B%86%E6%88%90/" title="SpringBoot-16：Dubbo和Zookeeper集成"><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvnmT.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot-16：Dubbo和Zookeeper集成"/></a><div class="content"><a class="title" href="/2022/06/01/SpringBoot-16%EF%BC%9ADubbo%E5%92%8CZookeeper%E9%9B%86%E6%88%90/" title="SpringBoot-16：Dubbo和Zookeeper集成">SpringBoot-16：Dubbo和Zookeeper集成</a><time datetime="2022-06-01T13:36:27.000Z" title="发表于 2022-06-01 21:36:27">2022-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/30/SpringBoot-15%EF%BC%9A%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/" title="SpringBoot-15：富文本编辑器"><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvikQ.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot-15：富文本编辑器"/></a><div class="content"><a class="title" href="/2022/05/30/SpringBoot-15%EF%BC%9A%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/" title="SpringBoot-15：富文本编辑器">SpringBoot-15：富文本编辑器</a><time datetime="2022-05-30T13:36:27.000Z" title="发表于 2022-05-30 21:36:27">2022-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/30/SpringBoot-14%EF%BC%9A%E5%BC%82%E6%AD%A5%E3%80%81%E5%AE%9A%E6%97%B6%E3%80%81%E9%82%AE%E4%BB%B6%E4%BB%BB%E5%8A%A1/" title="SpringBoot-14：异步、定时、邮件任务"><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvEpn.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot-14：异步、定时、邮件任务"/></a><div class="content"><a class="title" href="/2022/05/30/SpringBoot-14%EF%BC%9A%E5%BC%82%E6%AD%A5%E3%80%81%E5%AE%9A%E6%97%B6%E3%80%81%E9%82%AE%E4%BB%B6%E4%BB%BB%E5%8A%A1/" title="SpringBoot-14：异步、定时、邮件任务">SpringBoot-14：异步、定时、邮件任务</a><time datetime="2022-05-30T13:36:26.000Z" title="发表于 2022-05-30 21:36:26">2022-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/30/SpringBoot-13%EF%BC%9A%E9%9B%86%E6%88%90Swagger%E7%BB%88%E6%9E%81%E7%89%88/" title="SpringBoot-13：集成Swagger终极版"><img src="/img/loading.gif" data-original="https://s1.ax1x.com/2022/05/08/OlvikQ.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot-13：集成Swagger终极版"/></a><div class="content"><a class="title" href="/2022/05/30/SpringBoot-13%EF%BC%9A%E9%9B%86%E6%88%90Swagger%E7%BB%88%E6%9E%81%E7%89%88/" title="SpringBoot-13：集成Swagger终极版">SpringBoot-13：集成Swagger终极版</a><time datetime="2022-05-30T13:36:25.000Z" title="发表于 2022-05-30 21:36:25">2022-05-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s1.ax1x.com/2022/05/08/OlvikQ.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By ChenNuo</div><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/"><img src="/img/loading.gif" data-original="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a><a style="margin-inline:5px" target="_blank" href="https://butterfly.js.org/"><img src="/img/loading.gif" data-original="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a><a style="margin-inline:5px" target="_blank" href="https://github.com/"><img src="/img/loading.gif" data-original="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Github托管"></a><a style="margin-inline:5px" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="/img/loading.gif" data-original="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-pi-one.vercel.app/',
      region: 'ap-shanghai',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.vemoji)'))
      }
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo-pi-one.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      document.getElementById('twikoo-count').innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?ChenNuo252";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="ChenNuo252";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script data-pjax>
  function card_artitalk_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-shuo"><div class="card-content" style="height:auto;min-height:280px;"><div class="item-headline"><i class="fas fa-comments"></i><span><a href="/artitalk/" title="artitalk page link">碎碎念</a></span><a id="cardVisual" style="cursor:pointer;float:right" onclick="cardVisual()">编辑</a></div><div id="artitalk_main" style="width:100%;height:100%;padding:1px"></div></div></div>';
    console.log('已挂载card_artitalk');
    parent_div_git.insertAdjacentHTML("afterbegin",item_html);
    (()=>{
      const init = () => {
        new Artitalk(Object.assign({
          appId: 'kKQRNJPKCYo7wK9QC4L9NP0J-MdYXbMMI',
          appKey: '2Ml0sIXU6Qiwgl1AdbV1VUSk',
        }, {"serverURL":"https://kKQRNJPKCYo7wK9QC4L9NP0J-MdYXbMMI.api.lncldglobal.com","lang":"zh","pageSize":1,"color1":"#49b1f5","color2":"#00c4b6","atEmoji":{"Mafumafu1":"https://cdn.jsdelivr.net/gh/GamerNoTitle/ValineCDN@master/Mafumafu/199749454.png","Mafumafu2":"https://cdn.jsdelivr.net/gh/GamerNoTitle/ValineCDN@master/Mafumafu/199749455.png"}} ))
      }
      if (typeof Artitalk === 'function') {
        init()
      } else {
        getScript('https://npm.elemecdn.com/artitalk').then(init)
      }
    })()
    }
  var elist = '/artitalk/,/posts/'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    card_artitalk_injector_config();
  }
  else if (epage === cpage){
    card_artitalk_injector_config();
  }
  </script><script async src="https://npm.elemecdn.com/hexo-butterfly-artitalk-pro/lib/card_visual.js"></script><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="/img/loading.gif" data-original="/img/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://unpkg.zhimg.com/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("http:www.chennuo252.top/api?ChenNuo252",['#e4dfd7', '#f9f4dc', '#f7e8aa', '#f7e8aa', '#f8df72', '#fcd217', '#fcc515', '#f28e16', '#fb8b05', '#d85916', '#f43e06'],'ChenNuo252')
    }
  </script><!-- hexo injector body_end end --><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>